# dokka_test
## Установка проекта

Для установки проекта на локальный компьютер, надо клонировать имеющийся репозиторий. После этого установить все зависимости из файла requirements.txt либо в корень, либо создать виртуальное окружение и установить все зависимости туда.
В качестве интерпретатора проекта рекомендуется использовать Python3.7 или более позднюю версию.

## Запуск проекта

Для запуска проекта надо выполнить команду (если зависимости установлены в venv, то надо сперва активировать venv):

    gunicorn -D -b 127.0.0.1:4000 app:app

В этой команде можно указать другой порт, если он занят, убрать опцию -D чтобы можно было видеть лог в консоли так же добавить воркеров, чтобы проект мог обрабатывать несколько запросов одновременно, если в этом есть необходимость.

## Использование проекта

Для того чтобы создать новую задачу, надо выполнить команду:

    curl -F file=@<path_to_csv_file> http://127.0.0.1:4000/api/calculateDistances
> Example output: {"status":"running","task_id":"65c49613-4384-40ce-a10f-9eca6121a030"}

где <path_to_csv_file> - абсолютный путь до файла в формате csv (значения разделяются запятой).

Для получения результатов работы задачи надо выполнить команду (где в качестве значения для параметра result_id нужно указать значение task_id из ответа полученного на отправку csv файла):

    curl http://127.0.0.1:4000/api/getResult?result_id=<task_id>
> Example output: {"data":{"links":[{"distance":6551.790411474185,"name":"AB"},{"distance":308043.2930811797,"name":"AC"},{"distance":312331.9771734416,"name":"BC"},{"distance":2491087.335058502,"name":"AD"},{"distance":2492932.9557860773,"name":"BD"},{"distance":2213378.4851220762,"name":"CD"}],"points":[{"address":"Bardahl - \u041c\u043e\u0442\u043e\u0440\u043d\u044b\u0435 \u043c\u0430\u0441\u043b\u0430 \u0438 \u043f\u0440\u0438\u0441\u0430\u0434\u043a\u0438, 4, \u041a\u0430\u0442\u0435\u0440\u0438\u043d\u0438 \u0417\u0435\u043b\u0435\u043d\u043a\u043e \u0432\u0443\u043b\u0438\u0446\u044f, \u0421\u0443\u043c\u0438, \u0421\u0443\u043c\u0441\u044c\u043a\u0430 \u043c\u0456\u0441\u044c\u043a\u0430 \u0433\u0440\u043e\u043c\u0430\u0434\u0430, \u0421\u0443\u043c\u0441\u044c\u043a\u0438\u0439 \u0440\u0430\u0439\u043e\u043d, \u0421\u0443\u043c\u0441\u044c\u043a\u0430 \u043e\u0431\u043b\u0430\u0441\u0442\u044c, 40016, \u0423\u043a\u0440\u0430\u0457\u043d\u0430","name":"A"},{"address":"\u041a\u043e\u0432\u043f\u0430\u043a\u0456\u0432\u0441\u044c\u043a\u0438\u0439 \u0440\u0430\u0439\u043e\u043d, \u0421\u0443\u043c\u0441\u044c\u043a\u0430 \u043c\u0456\u0441\u044c\u043a\u0430 \u0433\u0440\u043e\u043c\u0430\u0434\u0430, \u0421\u0443\u043c\u0441\u044c\u043a\u0438\u0439 \u0440\u0430\u0439\u043e\u043d, \u0421\u0443\u043c\u0441\u044c\u043a\u0430 \u043e\u0431\u043b\u0430\u0441\u0442\u044c, 40010, \u0423\u043a\u0440\u0430\u0457\u043d\u0430","name":"B"},{"address":"\u0427\u0435\u0440\u0432\u043e\u043d\u0438\u0439 \u043a\u043e\u0440\u043f\u0443\u0441, 60, \u0412\u043e\u043b\u043e\u0434\u0438\u043c\u0438\u0440\u0441\u044c\u043a\u0430 \u0432\u0443\u043b\u0438\u0446\u044f, \u0421\u0442\u0430\u0440\u0438\u0439 \u041a\u0438\u0457\u0432, \u0426\u0435\u043d\u0442\u0440, \u0428\u0435\u0432\u0447\u0435\u043d\u043a\u0456\u0432\u0441\u044c\u043a\u0438\u0439 \u0440\u0430\u0439\u043e\u043d, \u041a\u0438\u0457\u0432, \u041a\u0438\u0457\u0432\u0441\u044c\u043a\u0430 \u043c\u0456\u0441\u044c\u043a\u0430 \u0433\u0440\u043e\u043c\u0430\u0434\u0430, 01025, \u0423\u043a\u0440\u0430\u0457\u043d\u0430","name":"C"},{"address":"Cherwell House, Abbey Walk, St Thomas', Osney, Oxford, Oxfordshire, South East England, England, OX1 1NN, United Kingdom","name":"D"}]},"status":"done","task_id":"65c49613-4384-40ce-a10f-9eca6121a030"}

## Остановка работы проекта

Для остановки работы проекта, если проект был запущен без опции -D достаточно в консоли где он работает нажать Ctrl-C, если же проект был запущен с опцией -D, то для его остановки надо выполнить команду:

    pkill gunicorn
